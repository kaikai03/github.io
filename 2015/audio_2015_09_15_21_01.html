<!doctype html>
<html class="no-js" lang="en">
<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="Access-Control-Allow-Origin" content="*">
        <link rel="stylesheet" href="/theme/css/foundation.min.css" media="all">
		<link rel="stylesheet" href="/theme/css/pygments.css" /> 
		<link rel="stylesheet" href="/theme/css/style.css" />
		<link rel="stylesheet" href="/theme/css/ukagaka.css" /> 
        <script type="text/javascript" src="/theme/js/modernizr.js"></script>
		<script type='text/javascript' src='/theme/js/jquery-1.11.1.min.js'></script>
	    <script type="text/javascript" src="/theme/js/damoo.min.js"></script>
		<script type="text/x-mathjax-config">MathJax.Hub.Config({tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}});</script>
        <script type="text/javascript">var js=document.createElement('script');js.setAttribute('src',(('https:' == document.location.protocol) ? ' https://' : ' http://')+'cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML');document.head.appendChild(js);</script>

        <link href='https://fonts.lug.ustc.edu.cn/css?family=Exo+2:400,300,700,300italic,400italic,700italic,900,900italic' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" href="/theme/css/lamboz.css" media="all">
        <title>音频相关零碎 - kairnsの记事簿</title>
        <meta charset="utf-8" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="kairnsの记事簿 Full Atom Feed" />
        <link href="/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="kairnsの记事簿 Full RSS Feed" />
        <!-- |format(category.slug) -->
        <link href="/feeds/{slug}.atom.xml" type="application/atom+xml" rel="alternate" title="kairnsの记事簿 Categories Atom Feed" />
 
 
        
        
</head>
<body onblur="leavePage()" onfocus="comebackPage()">
    <div class="pages">
        <ul>
            <li class="home"><a href="/index.html">Home</a></li>
            <li ><a href="/pages/about-me.html">About Me</a></li>
        </ul>
    </div>

<div class="hp-header-inner">
    <div class="page-header">
        <div class="content-header">
            <div id="title-block">
            <h1>  <a href="/2015/audio_2015_09_15_21_01.html" rel="bookmark"
                    title="Permalink to 音频相关零碎">音频相关零碎</a></h1>
            </div>
        </div>
    </div>
</div>
    <div class="content">
        <div class="data-holder">
        <div class="row">
           <div class="large-9 content-column column">
<div class="content-article">
    <header class="header-article">
        <div class="read-more">Posted on Tue 15 September 2015</div>
 
   </header>
    <section class='article'>
        
        <div class="entry-summary">
            <p>map3、aac解码，wav解析，频谱绘制，PCM播放等</p>
        </div>
    
        <div class="entry-content">
            <h2>for OBS</h2>
<p>因为咪啪这个项目需要，写了个音频类给开发同事。
什么解码解析播放都是附带的，目的是那个绘制频谱。</p>
<p>大致逻辑是解码-&gt;得到pcm-&gt;采样-&gt;归一化-&gt;双声道混mono-&gt;渲染电平</p>
<p>最后为了能够进行预处理，不占用演奏初始化时间，加了个渲染出来的东西保存成文件。</p>
<p>最开始采样是放在后面的，后来发现对内存要求太高，所以干脆把采样放到前面去了。</p>
<div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;Audio_tool_kk.h&quot;</span><span class="cp"></span>

<span class="c1">//两个第三方库</span>
<span class="cp">#include</span> <span class="cpf">&quot;decodeaac/decthread.h&quot;</span><span class="cp"></span>
<span class="cp">#pragma comment (lib,&quot;dsound.lib&quot;)</span>
<span class="cp">#pragma comment(lib, &quot;libmpg123.lib&quot;)</span>

<span class="cp">#pragma once</span>


<span class="kt">bool</span> <span class="n">Audio_tool_kk</span><span class="o">::</span><span class="n">load_MP3_file</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">fname</span><span class="p">,</span> <span class="n">audioData</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">audio</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">;</span>

    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">BYTE</span> <span class="o">*</span><span class="n">buffer</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">err</span> <span class="o">=</span> <span class="n">MPG123_OK</span><span class="p">;</span>                               
        <span class="kt">long</span> <span class="n">rate</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">channels</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">enc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">bits_per_sample</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>


        <span class="k">if</span> <span class="p">(</span><span class="n">mpg123_init</span><span class="p">()</span> <span class="o">!=</span> <span class="n">MPG123_OK</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;MP3 decoder init error&quot;</span><span class="p">));</span>
            <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">mpg123_handle</span> <span class="o">*</span><span class="n">m</span> <span class="o">=</span> <span class="n">mpg123_new</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">err</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">!=</span> <span class="n">MPG123_OK</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;MP3 decoder Create error&quot;</span><span class="p">));</span>
            <span class="n">mpg123_exit</span><span class="p">();</span>
            <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">mpg123_open</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span> <span class="o">!=</span> <span class="n">MPG123_OK</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;MP3 open failse&quot;</span><span class="p">));</span>
            <span class="n">mpg123_delete</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
            <span class="n">mpg123_exit</span><span class="p">();</span>
            <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">((</span><span class="n">err</span> <span class="o">=</span> <span class="n">mpg123_getformat</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">rate</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">channels</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">enc</span><span class="p">))</span> <span class="o">==</span> <span class="n">MPG123_OK</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="cm">/*  //maybe not support</span>
<span class="cm">            if (enc != MPG123_ENC_SIGNED_16 &amp;amp;&amp;amp; enc != MPG123_ENC_FLOAT_32)</span>
<span class="cm">            {</span>
<span class="cm">                Log(TEXT(&quot;Bad encoding,no support: : 0x%x&quot;), enc);</span>
<span class="cm">                mpg123_delete(m);</span>
<span class="cm">                mpg123_exit();</span>
<span class="cm">                fclose(fp);</span>
<span class="cm">                return FALSE;</span>
<span class="cm">            }</span>
<span class="cm">            */</span>
            <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;rate: %lu,channels: %d, enc: %d&quot;</span><span class="p">),</span> <span class="n">rate</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">enc</span><span class="p">);</span>
            <span class="n">bits_per_sample</span> <span class="o">=</span> <span class="n">mpg123_encsize</span><span class="p">(</span><span class="n">enc</span><span class="p">)</span> <span class="o">*</span> <span class="mi">8</span><span class="p">;</span>
            <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;bits_per_sample: : %d&quot;</span><span class="p">),</span> <span class="n">bits_per_sample</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;MP3 getformat err: %d&quot;</span><span class="p">),</span> <span class="n">err</span><span class="p">);</span>
            <span class="n">mpg123_delete</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
            <span class="n">mpg123_exit</span><span class="p">();</span>
            <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="p">}</span>


        <span class="kt">long</span> <span class="n">n</span> <span class="o">=</span> <span class="n">mpg123_length</span><span class="p">(</span><span class="n">m</span><span class="p">)</span> <span class="o">*</span> <span class="n">bits_per_sample</span> <span class="o">*</span> <span class="n">channels</span> <span class="o">/</span> <span class="mi">8</span><span class="p">;</span>  <span class="c1">//通过采样总数*每采样比特数*声道/8获得字节数  </span>
        <span class="kt">size_t</span> <span class="n">done</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">buffer</span> <span class="o">=</span> <span class="p">(</span><span class="n">BYTE</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>

        <span class="n">err</span> <span class="o">=</span> <span class="n">mpg123_read</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">buffer</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">done</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">err</span> <span class="o">!=</span> <span class="n">MPG123_OK</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">err</span> <span class="o">!=</span> <span class="n">MPG123_DONE</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;MP3 decoder err: %d&quot;</span><span class="p">),</span> <span class="n">err</span><span class="p">);</span>
            <span class="n">free</span><span class="p">(</span><span class="n">buffer</span><span class="p">);</span>
            <span class="n">mpg123_delete</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
            <span class="n">mpg123_exit</span><span class="p">();</span>
            <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;done: %d&quot;</span><span class="p">),</span> <span class="n">done</span><span class="p">);</span>


        <span class="n">audio</span><span class="p">.</span><span class="n">sample_rate</span> <span class="o">=</span> <span class="n">rate</span><span class="p">;</span>
        <span class="n">audio</span><span class="p">.</span><span class="n">channels</span> <span class="o">=</span> <span class="n">channels</span><span class="p">;</span>
        <span class="n">audio</span><span class="p">.</span><span class="n">bits_per_sample</span> <span class="o">=</span> <span class="n">bits_per_sample</span><span class="p">;</span>
        <span class="n">audio</span><span class="p">.</span><span class="n">avg_bytes_sec</span> <span class="o">=</span> <span class="n">rate</span> <span class="o">*</span> <span class="n">bits_per_sample</span> <span class="o">*</span> <span class="n">channels</span> <span class="o">/</span> <span class="mi">8</span><span class="p">;</span>
        <span class="n">audio</span><span class="p">.</span><span class="n">block_align</span> <span class="o">=</span> <span class="n">bits_per_sample</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">channels</span><span class="p">;</span> <span class="c1">// i guess... not sure, this mean the bytes of every sample</span>
        <span class="n">audio</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">buffer</span><span class="p">;</span>
        <span class="n">audio</span><span class="p">.</span><span class="n">data_size</span> <span class="o">=</span> <span class="n">done</span><span class="p">;</span>
        <span class="n">audio</span><span class="p">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data_size</span> <span class="o">/</span> <span class="n">audio</span><span class="p">.</span><span class="n">avg_bytes_sec</span><span class="p">;</span><span class="c1">//总的播放时间</span>
        <span class="n">audio</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">done</span> <span class="o">+</span> <span class="mi">44</span> <span class="o">-</span> <span class="mi">8</span><span class="p">;</span>

        <span class="kt">char</span> <span class="n">outfname</span><span class="p">[</span><span class="mi">128</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
        <span class="n">changSuffixName</span><span class="p">(</span><span class="n">outfname</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">MP3_SUFFIXNAME</span><span class="p">,</span> <span class="n">WAV_SUFFIXNAME</span><span class="p">);</span>
        <span class="c1">//char* mp3Str = strstri(fname, &quot;.mp3&quot;);</span>
        <span class="c1">//if (mp3Str)</span>
        <span class="c1">//{</span>
        <span class="c1">//  int len = strlen(fname) - strlen(mp3Str);</span>
        <span class="c1">//  memcpy(outfname, fname, len);</span>
        <span class="c1">//  memcpy(outfname + len, &quot;.wav&quot;, 4);</span>
            <span class="n">save_curAudio_2_file</span><span class="p">(</span><span class="n">outfname</span><span class="p">);</span><span class="c1">//20150831-hll</span>
        <span class="c1">//}</span>
        <span class="n">mpg123_delete</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
        <span class="n">mpg123_exit</span><span class="p">();</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span><span class="p">{</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Error: MP3 file load error&quot;</span><span class="p">));</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">write_wave_file</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">fname</span><span class="p">,</span> <span class="n">audioData</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">audio</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">audio</span><span class="p">.</span><span class="n">data</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Error: load file first&quot;</span><span class="p">));</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">;</span>

    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">WriteWaveHeader</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">audio</span><span class="p">.</span><span class="n">data_size</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">audio</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">audio</span><span class="p">.</span><span class="n">channels</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">audio</span><span class="p">.</span><span class="n">bits_per_sample</span><span class="p">);</span>
        <span class="n">fwrite</span><span class="p">(</span><span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">audio</span><span class="p">.</span><span class="n">data_size</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>

        <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>

        <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Error: write file open error&quot;</span><span class="p">));</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Audio_tool_kk</span><span class="o">::</span><span class="n">load_wave_file</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">fname</span><span class="p">,</span> <span class="n">audioData</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">audio</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">FILE</span> <span class="o">*</span><span class="n">fp</span><span class="p">;</span>

    <span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">char</span> <span class="n">id</span><span class="p">[</span><span class="mi">5</span><span class="p">];</span>          <span class="c1">// &#39;RIFF&#39;and&#39;\0&#39; for strcmp</span>
        <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">size</span><span class="p">;</span>  <span class="c1">// file size</span>

        <span class="kt">short</span> <span class="n">format_tag</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">block_align</span><span class="p">,</span> <span class="n">bits_per_sample</span><span class="p">;</span>    <span class="c1">// 16bits</span>

        <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">format_length</span><span class="p">,</span> <span class="n">sample_rate</span><span class="p">,</span> <span class="n">avg_bytes_sec</span><span class="p">,</span> <span class="n">data_size</span><span class="p">;</span> <span class="c1">// 32bits</span>

        <span class="n">fread</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span> <span class="c1">// &#39;RIFF&#39;</span>
        <span class="n">id</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;WAVE id: %c%c%c%c&quot;</span><span class="p">),</span> <span class="n">id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">id</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">id</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">id</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="s">&quot;RIFF&quot;</span><span class="p">))</span>
        <span class="p">{</span>
            <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">size</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span> <span class="c1">// file size</span>
            <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;size: %lu&quot;</span><span class="p">),</span> <span class="n">size</span><span class="p">);</span>

            <span class="n">fread</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>         <span class="c1">// &#39;WAVE&#39;</span>
            <span class="n">id</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
            <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;WAVE id: %c%c%c%c&quot;</span><span class="p">),</span> <span class="n">id</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">id</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">id</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">id</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">strcmp</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="s">&quot;WAVE&quot;</span><span class="p">))</span>
            <span class="p">{</span>
                <span class="n">fread</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>     <span class="c1">//  &quot;fmt &quot;;</span>
                <span class="c1">//Log(TEXT(&quot;WAVE id: %c%c%c%c&quot;), id[0], id[1], id[2], id[3]);</span>

                <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">format_length</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
                <span class="c1">//Log(TEXT(&quot;format_length: %lu&quot;), format_length);</span>

                <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">format_tag</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">short</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span> <span class="c1">// tag</span>
                <span class="c1">//Log(TEXT(&quot;format_tag: %d&quot;), format_tag);</span>

                <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">channels</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">short</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>    <span class="c1">// channels</span>
                <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;channels: %d&quot;</span><span class="p">),</span> <span class="n">channels</span><span class="p">);</span>

                <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">sample_rate</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>   <span class="c1">// sample_rate</span>
                <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;sample_rate: %lu&quot;</span><span class="p">),</span> <span class="n">sample_rate</span><span class="p">);</span>

                <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">avg_bytes_sec</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span> <span class="c1">// avg_bytes_sec</span>
                <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;avg_bytes_sec: %lu&quot;</span><span class="p">),</span> <span class="n">avg_bytes_sec</span><span class="p">);</span>

                <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">block_align</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">short</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>     <span class="c1">// block_align</span>
                <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;block_align: %d&quot;</span><span class="p">),</span> <span class="n">block_align</span><span class="p">);</span>

                <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">bits_per_sample</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">short</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>       <span class="c1">// bits_per_sample</span>
                <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;bits_per_sample: %d&quot;</span><span class="p">),</span> <span class="n">bits_per_sample</span><span class="p">);</span>

                <span class="n">fread</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>                      <span class="c1">// &#39;data&#39;</span>

                <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">data_size</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>     <span class="c1">// data size</span>
                <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;data_size: %lu&quot;</span><span class="p">),</span> <span class="n">data_size</span><span class="p">);</span>

                <span class="n">audio</span><span class="p">.</span><span class="n">size</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>
                <span class="n">audio</span><span class="p">.</span><span class="n">data_size</span> <span class="o">=</span> <span class="n">data_size</span><span class="p">;</span>
                <span class="n">audio</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">BYTE</span><span class="p">)</span><span class="o">*</span><span class="n">data_size</span><span class="p">);</span>
                <span class="n">fread</span><span class="p">(</span><span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">),</span> <span class="n">data_size</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>

                <span class="n">audio</span><span class="p">.</span><span class="n">format_tag</span> <span class="o">=</span> <span class="n">format_tag</span><span class="p">;</span>
                <span class="n">audio</span><span class="p">.</span><span class="n">channels</span> <span class="o">=</span> <span class="n">channels</span><span class="p">;</span>
                <span class="n">audio</span><span class="p">.</span><span class="n">block_align</span> <span class="o">=</span> <span class="n">block_align</span><span class="p">;</span>
                <span class="n">audio</span><span class="p">.</span><span class="n">bits_per_sample</span> <span class="o">=</span> <span class="n">bits_per_sample</span><span class="p">;</span>
                <span class="n">audio</span><span class="p">.</span><span class="n">format_length</span> <span class="o">=</span> <span class="n">format_length</span><span class="p">;</span>
                <span class="n">audio</span><span class="p">.</span><span class="n">sample_rate</span> <span class="o">=</span> <span class="n">sample_rate</span><span class="p">;</span>
                <span class="n">audio</span><span class="p">.</span><span class="n">avg_bytes_sec</span> <span class="o">=</span> <span class="n">avg_bytes_sec</span><span class="p">;</span>
                <span class="n">audio</span><span class="p">.</span><span class="n">duration</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data_size</span> <span class="o">/</span> <span class="n">audio</span><span class="p">.</span><span class="n">avg_bytes_sec</span><span class="p">;</span><span class="c1">//总的播放时间</span>

                <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;wav load sucess&quot;</span><span class="p">));</span>
                <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
                <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Error: RIFF file but not a wave file&quot;</span><span class="p">));</span>
                <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
                <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;Error: not a RIFF file&quot;</span><span class="p">));</span>
            <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">write_16_bits_low_high</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span> <span class="n">fp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">bytes</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
    <span class="n">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="mh">0xff</span><span class="p">);</span>
    <span class="n">bytes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">val</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="mh">0xff</span><span class="p">);</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="n">bytes</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">write_32_bits_low_high</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span> <span class="n">fp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">val</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">unsigned</span> <span class="kt">char</span> <span class="n">bytes</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
    <span class="n">bytes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="mh">0xff</span><span class="p">);</span>
    <span class="n">bytes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">val</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">8</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="mh">0xff</span><span class="p">);</span>
    <span class="n">bytes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">val</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">16</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="mh">0xff</span><span class="p">);</span>
    <span class="n">bytes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="n">val</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">24</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="mh">0xff</span><span class="p">);</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="n">bytes</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">WriteWaveHeader</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span> <span class="k">const</span> <span class="n">fp</span><span class="p">,</span> <span class="kt">int</span> <span class="n">pcmbytes</span><span class="p">,</span> <span class="kt">int</span> <span class="n">freq</span><span class="p">,</span> <span class="kt">int</span> <span class="n">channels</span><span class="p">,</span> <span class="kt">int</span> <span class="n">bits</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span>     <span class="n">bytes</span> <span class="o">=</span> <span class="p">(</span><span class="n">bits</span> <span class="o">+</span> <span class="mi">7</span><span class="p">)</span> <span class="o">/</span> <span class="mi">8</span><span class="p">;</span>
    <span class="cm">/* quick and dirty, but documented */</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="s">&quot;RIFF&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span> <span class="cm">/* label */</span>
    <span class="n">write_32_bits_low_high</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">pcmbytes</span> <span class="o">+</span> <span class="mi">44</span> <span class="o">-</span> <span class="mi">8</span><span class="p">);</span> <span class="cm">/* length in bytes without header */</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="s">&quot;WAVEfmt &quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span> <span class="cm">/* 2 labels */</span>
    <span class="n">write_32_bits_low_high</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span> <span class="cm">/* length of PCM format declaration area */</span>
    <span class="n">write_16_bits_low_high</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="cm">/* is PCM? */</span>
    <span class="n">write_16_bits_low_high</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">channels</span><span class="p">);</span> <span class="cm">/* number of channels */</span>
    <span class="n">write_32_bits_low_high</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">freq</span><span class="p">);</span> <span class="cm">/* sample frequency in [Hz] */</span>
    <span class="n">write_32_bits_low_high</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">freq</span> <span class="o">*</span> <span class="n">channels</span> <span class="o">*</span> <span class="n">bytes</span><span class="p">);</span> <span class="cm">/* bytes per second */</span>
    <span class="n">write_16_bits_low_high</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">channels</span> <span class="o">*</span> <span class="n">bytes</span><span class="p">);</span> <span class="cm">/* bytes per sample time */</span>
    <span class="n">write_16_bits_low_high</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">bits</span><span class="p">);</span> <span class="cm">/* bits per sample */</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="s">&quot;data&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span> <span class="cm">/* label */</span>
    <span class="n">write_32_bits_low_high</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">pcmbytes</span><span class="p">);</span> <span class="cm">/* length in bytes of raw PCM data */</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="n">hex_char_value</span><span class="p">(</span><span class="kt">char</span> <span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">=</span> <span class="sc">&#39;0&#39;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">c</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">=</span> <span class="sc">&#39;9&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">c</span> <span class="o">-</span> <span class="sc">&#39;0&#39;</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">=</span> <span class="sc">&#39;a&#39;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">c</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">=</span> <span class="sc">&#39;f&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="sc">&#39;a&#39;</span> <span class="o">+</span> <span class="mi">10</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">=</span> <span class="sc">&#39;A&#39;</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">c</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="o">=</span> <span class="sc">&#39;F&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="sc">&#39;A&#39;</span> <span class="o">+</span> <span class="mi">10</span><span class="p">);</span>
    <span class="c1">//assert(0);</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">hex_to_decimal</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">szHex</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">result</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">len</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">result</span> <span class="o">+=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">pow</span><span class="p">((</span><span class="kt">float</span><span class="p">)</span><span class="mi">16</span><span class="p">,</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">len</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">hex_char_value</span><span class="p">(</span><span class="n">szHex</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">audioData_normalize_16</span><span class="p">(</span><span class="n">BYTE</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dataSize</span><span class="p">,</span> <span class="kt">double</span> <span class="o">*</span><span class="n">dst</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">dataSize</span><span class="p">;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">low</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">low</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="c1">//Log(TEXT(&quot;    data_low: %lu,%x,%x&quot;), low, low, data[i]);</span>

        <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">high</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">high</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
        <span class="c1">//Log(TEXT(&quot;    data_high: %lu,%x,%x&quot;), high, high, data[i + 1]);</span>

        <span class="kt">double</span> <span class="n">data_true</span> <span class="o">=</span> <span class="n">high</span> <span class="o">*</span> <span class="mi">256</span> <span class="o">+</span> <span class="n">low</span><span class="p">;</span>
        <span class="c1">//Log(TEXT(&quot;    data_true: %f,%x&quot;), data_true, data_true);</span>

        <span class="kt">double</span> <span class="n">data_complement</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="kt">int</span> <span class="n">my_sign</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)(</span><span class="n">high</span> <span class="o">/</span> <span class="mi">128</span><span class="p">);</span>
        <span class="c1">//Log(TEXT(&quot;    my_sign: %d&quot;), my_sign);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">my_sign</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">data_complement</span> <span class="o">=</span> <span class="n">data_true</span> <span class="o">-</span> <span class="mi">65536</span><span class="p">;</span> <span class="c1">//补码</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">data_complement</span> <span class="o">=</span> <span class="n">data_true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">//double db = 20.0f * log10(sqrt(data_complement*data_complement));</span>
        <span class="c1">//Log(TEXT(&quot;    data_complement: %f&quot;), data_complement);</span>
        <span class="kt">double</span> <span class="n">float_data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">data_complement</span> <span class="o">/</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="mi">32768</span><span class="p">);</span>
        <span class="c1">//Log(TEXT(&quot;float_data: %f&quot;), float_data);</span>
        <span class="kt">int</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">memcpy</span><span class="p">(</span><span class="n">dst</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">float_data</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>

        <span class="c1">//Log(TEXT(&quot;data[%d]: %f, %f, %f&quot;), i, float_data, dst[offset], db);</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">audioData_normalize_8</span><span class="p">(</span><span class="n">BYTE</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dataSize</span><span class="p">,</span> <span class="kt">double</span> <span class="o">*</span><span class="n">dst</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">dataSize</span><span class="p">;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">unsigned</span> <span class="kt">short</span> <span class="n">val</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="kt">double</span> <span class="n">data_complement</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="cm">/*</span>
<span class="cm">        int my_sign = (int)(val / 128);</span>
<span class="cm">        if (my_sign == 1)</span>
<span class="cm">        {</span>
<span class="cm">            data_complement = val - 254; //补码</span>
<span class="cm">        }</span>
<span class="cm">        else</span>
<span class="cm">        {</span>
<span class="cm">            data_complement = val;</span>
<span class="cm">        }</span>
<span class="cm">        */</span>

        <span class="n">data_complement</span> <span class="o">=</span> <span class="n">val</span> <span class="o">-</span> <span class="mi">128</span><span class="p">;</span>

        <span class="kt">double</span> <span class="n">float_data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span><span class="p">)(</span><span class="n">data_complement</span> <span class="o">/</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="mi">128</span><span class="p">);</span>
        <span class="c1">//Log(TEXT(&quot;data[%d]: val:%d, my_sign:%d, data_complement:%f, float_data:%f&quot;), i, val, my_sign, data_complement, float_data);</span>
        <span class="n">memcpy</span><span class="p">(</span><span class="n">dst</span> <span class="o">+</span> <span class="n">i</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">float_data</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>

        <span class="c1">//Log(TEXT(&quot;data[%d]: %f, %f, %f&quot;), i, float_data, dst[offset], db);</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">double</span> <span class="n">mix2mono_float</span><span class="p">(</span><span class="kt">double</span> <span class="n">c1</span><span class="p">,</span> <span class="kt">double</span> <span class="n">c2</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//C = A + B - (A * B &amp;gt;&amp;gt; 0x10)</span>
    <span class="kt">double</span> <span class="n">val</span><span class="p">;</span><span class="c1">// = (c1 + c2) / 2;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">c1</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="mi">0</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">c2</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">+</span> <span class="n">c2</span> <span class="o">-</span> <span class="p">(</span><span class="n">c1</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">/</span> <span class="o">-</span><span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">16</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span>
    <span class="k">else</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">+</span> <span class="n">c2</span> <span class="o">-</span> <span class="p">(</span><span class="n">c1</span> <span class="o">*</span> <span class="n">c2</span> <span class="o">/</span> <span class="p">(</span><span class="n">pow</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">16</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span>
    <span class="c1">//Log(TEXT(&quot;        c1: %f, c2: %f, val: %f&quot;), c1, c2, val);</span>

    <span class="n">val</span> <span class="o">=</span> <span class="n">val</span><span class="o">*</span><span class="mf">0.51</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">val</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">val</span><span class="p">;</span>

<span class="p">}</span>

<span class="kt">void</span> <span class="n">mix2mono_normalize</span><span class="p">(</span><span class="kt">double</span> <span class="o">*</span><span class="n">normalization_data</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">dataSize</span><span class="p">,</span> <span class="kt">double</span> <span class="o">*</span><span class="n">dst</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">dataSize</span><span class="p">;</span> <span class="n">i</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">double</span> <span class="n">c1</span> <span class="o">=</span> <span class="n">normalization_data</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="kt">double</span> <span class="n">c2</span> <span class="o">=</span> <span class="n">normalization_data</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
        <span class="c1">//Log(TEXT(&quot;data[1]: %f , data[2]: %f, c1: %f, c2: %f&quot;), normalization_data[i], normalization_data[i+1], c1, c2);</span>
        <span class="kt">double</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">mix2mono_float</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">);</span>
        <span class="kt">double</span> <span class="n">float_data</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">offset</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">memcpy</span><span class="p">(</span><span class="n">dst</span> <span class="o">+</span> <span class="n">offset</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">float_data</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>


<span class="kt">bool</span> <span class="n">Audio_tool_kk</span><span class="o">::</span><span class="n">load_wave</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">fname</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">audio</span><span class="p">.</span><span class="n">data</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">audio</span><span class="p">.</span><span class="n">freeAudioData</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">Audio_tool_kk</span><span class="o">::</span><span class="n">load_wave_file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">audio</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Audio_tool_kk</span><span class="o">::</span><span class="n">load_MP3</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">fname</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">audio</span><span class="p">.</span><span class="n">data</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">audio</span><span class="p">.</span><span class="n">freeAudioData</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">Audio_tool_kk</span><span class="o">::</span><span class="n">load_MP3_file</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">audio</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Audio_tool_kk</span><span class="o">::</span><span class="n">save_curAudio_2_file</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">outfname</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">write_wave_file</span><span class="p">(</span><span class="n">outfname</span><span class="p">,</span> <span class="n">audio</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">ChangeFontSize</span><span class="p">(</span><span class="n">HDC</span> <span class="n">hdc</span><span class="p">,</span> <span class="kt">int</span> <span class="n">size</span><span class="p">,</span> <span class="n">COLORREF</span> <span class="n">color</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">LOGFONT</span> <span class="n">lf</span><span class="p">;</span>
    <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">lf</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">LOGFONT</span><span class="p">));</span>
    <span class="n">lf</span><span class="p">.</span><span class="n">lfHeight</span> <span class="o">=</span> <span class="n">MulDiv</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="n">GetDeviceCaps</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="n">LOGPIXELSY</span><span class="p">),</span> <span class="mi">72</span><span class="p">);</span><span class="c1">//设置字体的大小</span>
    <span class="n">lf</span><span class="p">.</span><span class="n">lfWeight</span> <span class="o">=</span> <span class="n">FW_NORMAL</span><span class="p">;</span>
    <span class="n">lf</span><span class="p">.</span><span class="n">lfCharSet</span> <span class="o">=</span> <span class="n">DEFAULT_CHARSET</span><span class="p">;</span>
    <span class="n">lf</span><span class="p">.</span><span class="n">lfWeight</span> <span class="o">=</span> <span class="n">FW_SEMIBOLD</span><span class="p">;</span>
    <span class="n">HANDLE</span> <span class="n">hFont</span> <span class="o">=</span> <span class="n">CreateFontIndirect</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">lf</span><span class="p">);</span>
    <span class="n">SelectObject</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="n">hFont</span><span class="p">);</span>
    <span class="n">SetBkMode</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="n">TRANSPARENT</span><span class="p">);</span><span class="c1">//绘画文字时以图片背景</span>
    <span class="n">SetTextColor</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="n">color</span><span class="p">);</span><span class="c1">//设置字体颜色 设置成黄色 </span>
    <span class="n">DeleteObject</span><span class="p">(</span><span class="n">hFont</span><span class="p">);</span>
    <span class="c1">//CloseHandle(hFont);</span>
<span class="p">}</span>
<span class="c1">//bool Audio_tool_kk::drawWaveform(HWND pWnd, HWND pWnd2, HBITMAP hBmp, HBITMAP btm)</span>
<span class="c1">//{</span>
<span class="c1">//  ::SendMessage(pWnd, BM_SETIMAGE, (WPARAM)IMAGE_BITMAP, LPARAM(hBmp));</span>
<span class="c1">//  ::SendMessage(pWnd2, BM_SETIMAGE, (WPARAM)IMAGE_BITMAP, (LPARAM)btm);</span>
<span class="c1">//</span>
<span class="c1">//  return TRUE;</span>
<span class="c1">//}</span>
<span class="kt">bool</span> <span class="n">Audio_tool_kk</span><span class="o">::</span><span class="n">drawWaveform</span><span class="p">(</span><span class="n">HWND</span> <span class="n">pWnd</span><span class="p">,</span> <span class="n">HWND</span> <span class="n">pWnd2</span><span class="p">,</span> <span class="n">TCHAR</span><span class="o">*</span> <span class="n">pathName</span><span class="p">)</span>
<span class="p">{</span>

    <span class="n">HBITMAP</span> <span class="n">hBmp</span> <span class="o">=</span> <span class="p">(</span><span class="n">HBITMAP</span><span class="p">)</span><span class="n">LoadImage</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">pathName</span><span class="p">,</span> <span class="n">IMAGE_BITMAP</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">LR_CREATEDIBSECTION</span> <span class="o">|</span> <span class="n">LR_LOADFROMFILE</span><span class="p">);</span>
    <span class="c1">//IDM_VFR</span>
    <span class="o">::</span><span class="n">SendMessage</span><span class="p">(</span><span class="n">pWnd</span><span class="p">,</span> <span class="n">BM_SETIMAGE</span><span class="p">,</span> <span class="p">(</span><span class="n">WPARAM</span><span class="p">)</span><span class="n">IMAGE_BITMAP</span><span class="p">,</span> <span class="n">LPARAM</span><span class="p">(</span><span class="n">hBmp</span><span class="p">));</span>


    <span class="n">HBITMAP</span> <span class="n">btm</span> <span class="o">=</span> <span class="n">LoadBitmap</span><span class="p">(</span><span class="n">hinstMain</span><span class="p">,</span> <span class="n">MAKEINTRESOURCE</span><span class="p">(</span><span class="n">IDB_BITMAP4</span><span class="p">));</span>
    <span class="o">::</span><span class="n">SendMessage</span><span class="p">(</span><span class="n">pWnd2</span><span class="p">,</span> <span class="n">BM_SETIMAGE</span><span class="p">,</span> <span class="p">(</span><span class="n">WPARAM</span><span class="p">)</span><span class="n">IMAGE_BITMAP</span><span class="p">,</span> <span class="p">(</span><span class="n">LPARAM</span><span class="p">)</span><span class="n">btm</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">BYTE</span> <span class="n">normalizationTemp</span><span class="p">[</span><span class="mi">100</span><span class="p">][</span><span class="mi">4001</span><span class="p">];</span>
<span class="kt">bool</span> <span class="n">Audio_tool_kk</span><span class="o">::</span><span class="n">CreateWaveformBmp</span><span class="p">(</span><span class="n">HWND</span> <span class="n">pWnd</span><span class="p">,</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">pathName</span><span class="p">)</span><span class="c1">//20150723-hll</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pWnd</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;cant be null&quot;</span><span class="p">));</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;load audio file first,please&quot;</span><span class="p">));</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">audio</span><span class="p">.</span><span class="n">channels</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">audio</span><span class="p">.</span><span class="n">channels</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;drawWaveform dont support more than 2 audio channels，audio channels: %s&quot;</span><span class="p">),</span> <span class="n">audio</span><span class="p">.</span><span class="n">channels</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">drawByts_size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">double</span> <span class="o">*</span><span class="n">normalization</span><span class="p">;</span>

    <span class="n">HDC</span> <span class="n">hdc</span> <span class="o">=</span> <span class="o">::</span><span class="n">GetDC</span><span class="p">(</span><span class="n">pWnd</span><span class="p">);</span>


    <span class="n">drawByts_size</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data_size</span><span class="p">;</span>
    <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;drawByts_size=%x&quot;</span><span class="p">,</span> <span class="n">drawByts_size</span><span class="p">));</span>

    <span class="kt">int</span> <span class="n">drawSimple</span> <span class="o">=</span> <span class="n">drawByts_size</span> <span class="o">/</span> <span class="n">width</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">resimpleCount</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">10</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">resimpleRate</span> <span class="o">=</span> <span class="n">drawSimple</span> <span class="o">/</span> <span class="n">resimpleCount</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="mi">100</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">normalizationTemp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">4001</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">sc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sc</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">resimpleCount</span><span class="p">;</span> <span class="n">sc</span><span class="o">++</span><span class="p">){</span><span class="c1">//resmiple</span>
        <span class="c1">//Log(TEXT(&quot;j=%d&quot;), j);</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">width</span> <span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">audio</span><span class="p">.</span><span class="n">bits_per_sample</span> <span class="o">==</span> <span class="mi">16</span><span class="p">)</span>
                <span class="p">{</span>

                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span><span class="p">];</span>

                    <span class="c1">//if (sc==99)</span>
                        <span class="c1">//Log(TEXT(&quot;sc=%d j=%d [sc][j]=%x     %x   %ld&quot;), sc, j, normalizationTemp[sc][j - 1], audio.data[drawSimple*i + sc*resimpleRate], drawSimple*i + sc*resimpleRate);</span>

                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>


                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>


                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span> <span class="o">+</span> <span class="mi">3</span><span class="p">];</span>


                    <span class="c1">//if (sc == 99)</span>
                        <span class="c1">//Log(TEXT(&quot;sc=%d j=%d [sc][j]=%x     %x   %ld&quot;), sc, j, normalizationTemp[sc][j - 1], audio.data[drawSimple*i + sc*resimpleRate], drawSimple*i + sc*resimpleRate);</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span><span class="p">];</span>
                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
                    <span class="c1">//if (sc==99)</span>
                    <span class="c1">//Log(TEXT(&quot;sc=%d j=%d [sc][j]=%x     %x   %ld&quot;), sc, j, normalizationTemp[sc][j - 1], audio.data[drawSimple*i + sc*resimpleRate], drawSimple*i + sc*resimpleRate);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">audio</span><span class="p">.</span><span class="n">bits_per_sample</span> <span class="o">==</span> <span class="mi">16</span><span class="p">)</span>
                <span class="p">{</span>

                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>


                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>


                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span> <span class="o">+</span> <span class="mi">3</span><span class="p">];</span>


                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span> <span class="o">+</span> <span class="mi">4</span><span class="p">];</span>

                    <span class="c1">//if (sc == 99)</span>
                        <span class="c1">//Log(TEXT(&quot;sc=%d j=%d [sc][j]=%x     %x   %ld&quot;), sc, j, normalizationTemp[sc][j - 1], audio.data[drawSimple*i + sc*resimpleRate], drawSimple*i + sc*resimpleRate);</span>


                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>
                    <span class="c1">//if (sc==99)</span>
                    <span class="c1">//Log(TEXT(&quot;sc=%d j=%d [sc][j]=%x     %x   %ld&quot;), sc, j, normalizationTemp[sc][j - 1], audio.data[drawSimple*i + sc*resimpleRate], drawSimple*i + sc*resimpleRate);</span>
                <span class="p">}</span>

            <span class="p">}</span>

        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">//Log(TEXT(&quot;j=%d&quot;), j);</span>

    <span class="kt">int</span> <span class="n">sizeCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="mi">100</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">sizeCount</span> <span class="o">+=</span> <span class="n">width</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">audio</span><span class="p">.</span><span class="n">bits_per_sample</span> <span class="o">==</span> <span class="mi">16</span><span class="p">)</span>
    <span class="p">{</span>

        <span class="n">BYTE</span><span class="o">*</span> <span class="n">normalizationByte</span> <span class="o">=</span> <span class="p">(</span><span class="n">BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BYTE</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sizeCount</span><span class="p">));</span>
        <span class="kt">int</span> <span class="n">j</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">width</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span><span class="c1">//resmiple</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">sc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sc</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">resimpleCount</span><span class="p">;</span><span class="n">sc</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>
                <span class="c1">//if (i &amp;lt; width)</span>
                <span class="p">{</span>
                    <span class="n">normalizationByte</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">n</span><span class="o">++</span><span class="p">];</span>
                    <span class="n">normalizationByte</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">n</span><span class="o">++</span><span class="p">];</span>
                    <span class="n">normalizationByte</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">n</span><span class="o">++</span><span class="p">];</span>
                    <span class="n">normalizationByte</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">n</span><span class="o">++</span><span class="p">];</span>
                <span class="p">}</span>
                <span class="c1">//else</span>
                <span class="c1">//{</span>
                <span class="c1">//  break;</span>
                <span class="c1">//}</span>


            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;j=%d&quot;</span><span class="p">),</span> <span class="n">j</span><span class="p">);</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;j=%d&quot;</span><span class="p">),</span> <span class="mi">4</span><span class="o">*</span><span class="n">sizeCount</span><span class="p">);</span>

        <span class="n">drawByts_size</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">sizeCount</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">normalization</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="o">*</span><span class="n">drawByts_size</span><span class="p">);</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">normalization</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">drawByts_size</span><span class="p">);</span>

        <span class="n">audioData_normalize_16</span><span class="p">(</span><span class="n">normalizationByte</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">sizeCount</span><span class="p">,</span> <span class="n">normalization</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">audio</span><span class="p">.</span><span class="n">bits_per_sample</span> <span class="o">==</span> <span class="mi">8</span><span class="p">){</span>


        <span class="n">BYTE</span><span class="o">*</span> <span class="n">normalizationByte</span> <span class="o">=</span> <span class="p">(</span><span class="n">BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BYTE</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sizeCount</span><span class="p">));</span>
        <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">width</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span><span class="c1">//resmiple</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">sc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sc</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">resimpleCount</span><span class="p">;</span> <span class="n">sc</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
                <span class="n">normalizationByte</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">n</span><span class="o">++</span><span class="p">];</span>
                <span class="n">normalizationByte</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">n</span><span class="o">++</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">drawByts_size</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">sizeCount</span><span class="p">;</span>
        <span class="n">normalization</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="o">*</span><span class="n">drawByts_size</span><span class="p">);</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">normalization</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">drawByts_size</span><span class="p">);</span>

        <span class="n">audioData_normalize_8</span><span class="p">(</span><span class="n">normalizationByte</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sizeCount</span><span class="p">,</span> <span class="n">normalization</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="o">::</span><span class="n">ReleaseDC</span><span class="p">(</span><span class="n">pWnd</span><span class="p">,</span> <span class="n">hdc</span><span class="p">);</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;bits per sample must be 8 or 16&quot;</span><span class="p">));</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="k">if</span> <span class="p">(</span><span class="n">audio</span><span class="p">.</span><span class="n">channels</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">afterMin2Mono_size</span> <span class="o">=</span> <span class="n">drawByts_size</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span>
        <span class="kt">double</span> <span class="o">*</span><span class="n">afterMin2Mono_normalization</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="o">*</span><span class="n">afterMin2Mono_size</span><span class="p">);</span>

        <span class="n">mix2mono_normalize</span><span class="p">(</span><span class="n">normalization</span><span class="p">,</span> <span class="n">drawByts_size</span><span class="p">,</span> <span class="n">afterMin2Mono_normalization</span><span class="p">);</span>
        <span class="n">free</span><span class="p">(</span><span class="n">normalization</span><span class="p">);</span>
        <span class="n">drawByts_size</span> <span class="o">=</span> <span class="n">afterMin2Mono_size</span><span class="p">;</span>
        <span class="n">normalization</span> <span class="o">=</span> <span class="n">afterMin2Mono_normalization</span><span class="p">;</span>
    <span class="p">}</span>



    <span class="n">HDC</span> <span class="n">memDC</span> <span class="o">=</span> <span class="n">CreateCompatibleDC</span><span class="p">(</span><span class="n">hdc</span><span class="p">);</span>
    <span class="n">HBITMAP</span> <span class="n">memBM</span> <span class="o">=</span> <span class="n">CreateCompatibleBitmap</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>
    <span class="n">HBITMAP</span> <span class="n">holdBM</span> <span class="o">=</span> <span class="p">(</span><span class="n">HBITMAP</span><span class="p">)</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">memBM</span><span class="p">);</span>

    <span class="n">RECT</span> <span class="n">rect</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">20</span> <span class="p">};</span>
    <span class="n">HBRUSH</span> <span class="n">newbrush</span> <span class="o">=</span> <span class="n">CreateSolidBrush</span><span class="p">(</span><span class="n">RGB</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
    <span class="n">HBRUSH</span> <span class="n">oldbrush</span> <span class="o">=</span> <span class="p">(</span><span class="n">HBRUSH</span><span class="p">)</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">newbrush</span><span class="p">);</span>
    <span class="n">FillRect</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">rect</span><span class="p">,</span> <span class="n">newbrush</span><span class="p">);</span>
    <span class="n">SelectObject</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">oldbrush</span><span class="p">);</span>
    <span class="n">DeleteObject</span><span class="p">(</span><span class="n">newbrush</span><span class="p">);</span>

    <span class="n">HPEN</span> <span class="n">tPen</span> <span class="o">=</span> <span class="n">CreatePen</span><span class="p">(</span><span class="n">PS_SOLID</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">));</span>
    <span class="n">HPEN</span> <span class="n">oPen</span> <span class="o">=</span> <span class="p">(</span><span class="n">HPEN</span><span class="p">)</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">tPen</span><span class="p">);</span>
    <span class="n">MoveToEx</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">LineTo</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">20</span><span class="p">);</span>
    <span class="n">ChangeFontSize</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">));</span>
    <span class="n">TCHAR</span>  <span class="n">tempTchr</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="mi">50</span><span class="p">;</span> <span class="n">i</span> <span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">MoveToEx</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="mi">20</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">LineTo</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">20</span> <span class="o">+</span> <span class="mi">6</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">timeTemp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">i</span><span class="o">*</span> <span class="n">audio</span><span class="p">.</span><span class="n">duration</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">timeTemp</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">timeTemp</span> <span class="o">%</span> <span class="mi">60</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
                    <span class="n">wsprintf</span><span class="p">(</span><span class="n">tempTchr</span><span class="p">,</span> <span class="sa">L</span><span class="s">&quot;%d:%d&quot;</span><span class="p">,</span> <span class="n">timeTemp</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span> <span class="n">timeTemp</span> <span class="o">%</span> <span class="mi">60</span><span class="p">);</span>
                <span class="k">else</span>
                    <span class="nf">wsprintf</span><span class="p">(</span><span class="n">tempTchr</span><span class="p">,</span> <span class="sa">L</span><span class="s">&quot;%d:0%d&quot;</span><span class="p">,</span> <span class="n">timeTemp</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span> <span class="n">timeTemp</span> <span class="o">%</span> <span class="mi">60</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">timeTemp</span> <span class="o">%</span> <span class="mi">60</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
                    <span class="n">wsprintf</span><span class="p">(</span><span class="n">tempTchr</span><span class="p">,</span> <span class="sa">L</span><span class="s">&quot;0%d:%d&quot;</span><span class="p">,</span> <span class="n">timeTemp</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span> <span class="n">timeTemp</span> <span class="o">%</span> <span class="mi">60</span><span class="p">);</span>
                <span class="k">else</span>
                    <span class="nf">wsprintf</span><span class="p">(</span><span class="n">tempTchr</span><span class="p">,</span> <span class="sa">L</span><span class="s">&quot;0%d:0%d&quot;</span><span class="p">,</span> <span class="n">timeTemp</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span> <span class="n">timeTemp</span> <span class="o">%</span> <span class="mi">60</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">ExtTextOut</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">15</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">20</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span> <span class="n">ETO_OPAQUE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">tempTchr</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span><span class="c1">//20080710</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">LineTo</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">20</span> <span class="o">+</span> <span class="mi">3</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="p">}</span>


    <span class="n">tPen</span> <span class="o">=</span> <span class="n">CreatePen</span><span class="p">(</span><span class="n">PS_SOLID</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">RGB</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
    <span class="n">oPen</span> <span class="o">=</span> <span class="p">(</span><span class="n">HPEN</span><span class="p">)</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">tPen</span><span class="p">);</span>

    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">drawOffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">heightRate</span> <span class="o">=</span> <span class="mf">1.0f</span> <span class="o">/</span> <span class="n">center</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">scCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">audio</span><span class="p">.</span><span class="n">channels</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">scCount</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">scCount</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;drawByts_size=%d&quot;</span><span class="p">),</span> <span class="n">drawByts_size</span><span class="p">);</span>
        <span class="kt">double</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">posy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">sc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sc</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">drawByts_size</span><span class="p">;</span> <span class="n">sc</span><span class="o">++</span><span class="p">){</span><span class="c1">//resmiple</span>
            <span class="n">MoveToEx</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">sc</span>  <span class="o">/</span> <span class="n">scCount</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
            <span class="c1">//for (int i = 0; i &amp;lt; width - sc; i++)</span>
            <span class="p">{</span>

                <span class="c1">//Log(TEXT(&quot;data[%d]: %f&quot;), i, normalization[i]);</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">normalization</span><span class="p">[</span><span class="n">sc</span><span class="p">];</span>

                <span class="n">posy</span> <span class="o">=</span> <span class="kt">int</span><span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="n">center</span> <span class="o">-</span> <span class="n">val</span> <span class="o">/</span> <span class="n">heightRate</span><span class="p">);</span>
                <span class="n">LineTo</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">sc</span>  <span class="o">/</span> <span class="n">scCount</span> <span class="o">+</span> <span class="n">drawOffset</span><span class="p">,</span> <span class="n">posy</span><span class="p">);</span>
                <span class="c1">//Log(TEXT(&quot;  [%d]:center = %d, normalization = %f, heightRate = %f,hi =%f, posy = %d &quot;), i, center, val, heightRate, hi, posy);</span>

            <span class="p">}</span>
        <span class="p">}</span>

    <span class="p">}</span>




    <span class="n">SelectObject</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">oPen</span><span class="p">);</span>
    <span class="n">DeleteObject</span><span class="p">(</span><span class="n">tPen</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">normalization</span><span class="p">)</span>
    <span class="n">free</span><span class="p">(</span><span class="n">normalization</span><span class="p">);</span>


    <span class="n">BITMAP</span> <span class="n">BmpInfo</span><span class="p">;</span>
    <span class="n">GetObject</span><span class="p">(</span><span class="n">memBM</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAP</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">BmpInfo</span><span class="p">);</span><span class="c1">//get info</span>
    <span class="kt">int</span> <span class="n">datasize</span> <span class="o">=</span> <span class="n">BmpInfo</span><span class="p">.</span><span class="n">bmWidthBytes</span><span class="o">*</span><span class="n">BmpInfo</span><span class="p">.</span><span class="n">bmHeight</span><span class="p">;</span>
    <span class="kt">char</span><span class="o">*</span><span class="n">bmp_data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">datasize</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">bmp_data</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SelectObject</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">holdBM</span><span class="p">);</span>
        <span class="n">DeleteObject</span><span class="p">(</span><span class="n">memBM</span><span class="p">);</span>
        <span class="n">DeleteObject</span><span class="p">(</span><span class="n">memDC</span><span class="p">);</span>
        <span class="o">::</span><span class="n">ReleaseDC</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">hdc</span><span class="p">);</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;bmp_data malloc err&quot;</span><span class="p">));</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">BITMAPINFO</span> <span class="n">binfo</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
    <span class="n">BITMAPINFOHEADER</span> <span class="o">*</span><span class="n">bh</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">binfo</span><span class="p">.</span><span class="n">bmiHeader</span><span class="p">;</span>

    <span class="n">bh</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">biBitCount</span> <span class="o">=</span> <span class="n">BmpInfo</span><span class="p">.</span><span class="n">bmBitsPixel</span><span class="p">;</span><span class="c1">//Bits</span>
    <span class="n">bh</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">biClrImportant</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">bh</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">biCompression</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">bh</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">biHeight</span> <span class="o">=</span> <span class="n">height</span><span class="p">;</span>
    <span class="n">bh</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">biPlanes</span> <span class="o">=</span> <span class="n">BmpInfo</span><span class="p">.</span><span class="n">bmPlanes</span><span class="p">;</span><span class="c1">//1</span>
    <span class="n">bh</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">biSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPINFO</span><span class="p">);</span>
    <span class="n">bh</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">biSizeImage</span> <span class="o">=</span> <span class="n">datasize</span><span class="p">;</span>
    <span class="n">bh</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">biWidth</span> <span class="o">=</span> <span class="n">width</span><span class="p">;</span>
    <span class="n">bh</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">biXPelsPerMeter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">bh</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">biYPelsPerMeter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">GetDIBits</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">memBM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">BmpInfo</span><span class="p">.</span><span class="n">bmHeight</span><span class="p">,</span> <span class="n">bmp_data</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">binfo</span><span class="p">,</span> <span class="n">DIB_RGB_COLORS</span><span class="p">);</span><span class="c1">//get RGB</span>


    <span class="n">BITMAPFILEHEADER</span> <span class="n">bfh</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span><span class="c1">//head </span>
    <span class="n">bfh</span><span class="p">.</span><span class="n">bfType</span> <span class="o">=</span> <span class="n">MAKEWORD</span><span class="p">(</span><span class="sc">&#39;B&#39;</span><span class="p">,</span> <span class="sc">&#39;M&#39;</span><span class="p">);</span>
    <span class="n">bfh</span><span class="p">.</span><span class="n">bfOffBits</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPFILEHEADER</span><span class="p">)</span><span class="o">+</span><span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPINFO</span><span class="p">);</span><span class="c1">//heat offset</span>
    <span class="n">bfh</span><span class="p">.</span><span class="n">bfSize</span> <span class="o">=</span> <span class="n">bfh</span><span class="p">.</span><span class="n">bfOffBits</span> <span class="o">+</span> <span class="n">datasize</span><span class="p">;</span><span class="c1">//full size</span>
    <span class="kt">FILE</span><span class="o">*</span><span class="n">fp</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">pathName</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">fp</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;tmp bmp write err&quot;</span><span class="p">));</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">bfh</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPFILEHEADER</span><span class="p">),</span> <span class="n">fp</span><span class="p">);</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">binfo</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPINFO</span><span class="p">),</span> <span class="n">fp</span><span class="p">);</span>
    <span class="n">fwrite</span><span class="p">(</span><span class="n">bmp_data</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">BmpInfo</span><span class="p">.</span><span class="n">bmWidthBytes</span><span class="o">*</span><span class="n">BmpInfo</span><span class="p">.</span><span class="n">bmHeight</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
    <span class="n">fclose</span><span class="p">(</span><span class="n">fp</span><span class="p">);</span>

    <span class="n">free</span><span class="p">(</span><span class="n">bmp_data</span><span class="p">);</span>
    <span class="n">SelectObject</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">holdBM</span><span class="p">);</span>
    <span class="n">DeleteObject</span><span class="p">(</span><span class="n">memBM</span><span class="p">);</span>
    <span class="n">DeleteObject</span><span class="p">(</span><span class="n">CreateDIBitmap</span><span class="p">);</span>
    <span class="n">DeleteObject</span><span class="p">(</span><span class="n">memDC</span><span class="p">);</span>
    <span class="n">DeleteDC</span><span class="p">(</span><span class="n">memDC</span><span class="p">);</span>

    <span class="o">::</span><span class="n">ReleaseDC</span><span class="p">(</span><span class="n">pWnd</span><span class="p">,</span> <span class="n">hdc</span><span class="p">);</span>



    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">bool</span> <span class="n">Audio_tool_kk</span><span class="o">::</span><span class="n">drawWaveform</span><span class="p">(</span><span class="n">HWND</span> <span class="n">pWnd</span><span class="p">,</span> <span class="n">HWND</span> <span class="n">pWnd2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">width</span><span class="p">,</span> <span class="kt">int</span> <span class="n">height</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pWnd</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;cant be null&quot;</span><span class="p">));</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;load audio file first,please&quot;</span><span class="p">));</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">audio</span><span class="p">.</span><span class="n">channels</span> <span class="o">!=</span> <span class="mi">2</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">audio</span><span class="p">.</span><span class="n">channels</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;drawWaveform dont support more than 2 audio channels，audio channels: %s&quot;</span><span class="p">),</span> <span class="n">audio</span><span class="p">.</span><span class="n">channels</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">drawByts_size</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">double</span> <span class="o">*</span><span class="n">normalization</span><span class="p">;</span>

    <span class="n">HDC</span> <span class="n">hdc</span> <span class="o">=</span> <span class="o">::</span><span class="n">GetDC</span><span class="p">(</span><span class="n">pWnd</span><span class="p">);</span>


    <span class="n">drawByts_size</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data_size</span><span class="p">;</span>
    <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;drawByts_size=%x&quot;</span><span class="p">,</span> <span class="n">drawByts_size</span><span class="p">));</span>

    <span class="kt">int</span> <span class="n">drawSimple</span> <span class="o">=</span> <span class="n">drawByts_size</span> <span class="o">/</span> <span class="n">width</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">resimpleCount</span> <span class="o">=</span> <span class="n">width</span> <span class="o">/</span> <span class="mi">10</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">resimpleRate</span> <span class="o">=</span> <span class="n">drawSimple</span> <span class="o">/</span> <span class="n">resimpleCount</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="mi">100</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">normalizationTemp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mh">0x00</span><span class="p">,</span> <span class="mi">4001</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">sc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sc</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">resimpleCount</span><span class="p">;</span> <span class="n">sc</span><span class="o">++</span><span class="p">){</span><span class="c1">//resmiple</span>
        <span class="c1">//Log(TEXT(&quot;j=%d&quot;), j);</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">width</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">audio</span><span class="p">.</span><span class="n">bits_per_sample</span> <span class="o">==</span> <span class="mi">16</span><span class="p">)</span>
                <span class="p">{</span>

                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span><span class="p">];</span>

                    <span class="c1">//if (sc == 99)</span>
                        <span class="c1">//Log(TEXT(&quot;sc=%d j=%d [sc][j]=%x     %x   %ld&quot;), sc, j, normalizationTemp[sc][j - 1], audio.data[drawSimple*i + sc*resimpleRate], drawSimple*i + sc*resimpleRate);</span>

                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>


                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>

                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span> <span class="o">+</span> <span class="mi">3</span><span class="p">];</span>

                    <span class="c1">//if (sc == 99)</span>
                        <span class="c1">//Log(TEXT(&quot;sc=%d j=%d [sc][j]=%x     %x   %ld&quot;), sc, j, normalizationTemp[sc][j - 1], audio.data[drawSimple*i + sc*resimpleRate], drawSimple*i + sc*resimpleRate);</span>
                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span><span class="p">];</span>
                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">audio</span><span class="p">.</span><span class="n">bits_per_sample</span> <span class="o">==</span> <span class="mi">16</span><span class="p">)</span>
                <span class="p">{</span>

                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>

                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>

                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span> <span class="o">+</span> <span class="mi">3</span><span class="p">];</span>

                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span> <span class="o">+</span> <span class="mi">4</span><span class="p">];</span>
                    <span class="c1">//if (sc == 99)</span>
                        <span class="c1">//Log(TEXT(&quot;sc=%d j=%d [sc][j]=%x     %x   %ld&quot;), sc, j, normalizationTemp[sc][j - 1], audio.data[drawSimple*i + sc*resimpleRate], drawSimple*i + sc*resimpleRate);</span>


                <span class="p">}</span>
                <span class="k">else</span>
                <span class="p">{</span>
                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span> <span class="o">+</span> <span class="mi">1</span><span class="p">];</span>
                    <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">[</span><span class="n">drawSimple</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">sc</span><span class="o">*</span><span class="n">resimpleRate</span> <span class="o">+</span> <span class="mi">2</span><span class="p">];</span>
                <span class="p">}</span>

            <span class="p">}</span>

        <span class="p">}</span>
    <span class="p">}</span>
    <span class="c1">//Log(TEXT(&quot;j=%d&quot;), j);</span>

    <span class="kt">int</span> <span class="n">sizeCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="mi">100</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">sizeCount</span> <span class="o">+=</span> <span class="n">width</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">audio</span><span class="p">.</span><span class="n">bits_per_sample</span> <span class="o">==</span> <span class="mi">16</span><span class="p">)</span>
    <span class="p">{</span>

        <span class="n">BYTE</span><span class="o">*</span> <span class="n">normalizationByte</span> <span class="o">=</span> <span class="p">(</span><span class="n">BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BYTE</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sizeCount</span><span class="p">));</span>
        <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">width</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span><span class="c1">//resmiple</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">sc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sc</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">resimpleCount</span><span class="p">;</span> <span class="n">sc</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">4</span><span class="p">;</span>
                <span class="c1">//if (i &amp;lt; width)</span>
                <span class="p">{</span>
                    <span class="n">normalizationByte</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">n</span><span class="o">++</span><span class="p">];</span>
                    <span class="n">normalizationByte</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">n</span><span class="o">++</span><span class="p">];</span>
                    <span class="n">normalizationByte</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">n</span><span class="o">++</span><span class="p">];</span>
                    <span class="n">normalizationByte</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">n</span><span class="o">++</span><span class="p">];</span>
                <span class="p">}</span>
                <span class="c1">//else</span>
                <span class="c1">//{</span>
                <span class="c1">//  break;</span>
                <span class="c1">//}</span>


            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;j=%d&quot;</span><span class="p">),</span> <span class="n">j</span><span class="p">);</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;j=%d&quot;</span><span class="p">),</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">sizeCount</span><span class="p">);</span>

        <span class="n">drawByts_size</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">sizeCount</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
        <span class="n">normalization</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="o">*</span><span class="n">drawByts_size</span><span class="p">);</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">normalization</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">drawByts_size</span><span class="p">);</span>

        <span class="n">audioData_normalize_16</span><span class="p">(</span><span class="n">normalizationByte</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">sizeCount</span><span class="p">,</span> <span class="n">normalization</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">audio</span><span class="p">.</span><span class="n">bits_per_sample</span> <span class="o">==</span> <span class="mi">8</span><span class="p">){</span>


        <span class="n">BYTE</span><span class="o">*</span> <span class="n">normalizationByte</span> <span class="o">=</span> <span class="p">(</span><span class="n">BYTE</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BYTE</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sizeCount</span><span class="p">));</span>
        <span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">width</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span><span class="c1">//resmiple</span>

            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">sc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sc</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">resimpleCount</span><span class="p">;</span> <span class="n">sc</span><span class="o">++</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span>
                <span class="n">normalizationByte</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">n</span><span class="o">++</span><span class="p">];</span>
                <span class="n">normalizationByte</span><span class="p">[</span><span class="n">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">normalizationTemp</span><span class="p">[</span><span class="n">sc</span><span class="p">][</span><span class="n">n</span><span class="o">++</span><span class="p">];</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">drawByts_size</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sizeCount</span><span class="p">;</span>
        <span class="n">normalization</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="o">*</span><span class="n">drawByts_size</span><span class="p">);</span>
        <span class="n">memset</span><span class="p">(</span><span class="n">normalization</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">drawByts_size</span><span class="p">);</span>

        <span class="n">audioData_normalize_8</span><span class="p">(</span><span class="n">normalizationByte</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">sizeCount</span><span class="p">,</span> <span class="n">normalization</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="o">::</span><span class="n">ReleaseDC</span><span class="p">(</span><span class="n">pWnd</span><span class="p">,</span> <span class="n">hdc</span><span class="p">);</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;bits per sample must be 8 or 16&quot;</span><span class="p">));</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>


    <span class="k">if</span> <span class="p">(</span><span class="n">audio</span><span class="p">.</span><span class="n">channels</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">unsigned</span> <span class="kt">long</span> <span class="n">afterMin2Mono_size</span> <span class="o">=</span> <span class="n">drawByts_size</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
        <span class="kt">double</span> <span class="o">*</span><span class="n">afterMin2Mono_normalization</span> <span class="o">=</span> <span class="p">(</span><span class="kt">double</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="o">*</span><span class="n">afterMin2Mono_size</span><span class="p">);</span>

        <span class="n">mix2mono_normalize</span><span class="p">(</span><span class="n">normalization</span><span class="p">,</span> <span class="n">drawByts_size</span><span class="p">,</span> <span class="n">afterMin2Mono_normalization</span><span class="p">);</span>
        <span class="n">free</span><span class="p">(</span><span class="n">normalization</span><span class="p">);</span>
        <span class="n">drawByts_size</span> <span class="o">=</span> <span class="n">afterMin2Mono_size</span><span class="p">;</span>
        <span class="n">normalization</span> <span class="o">=</span> <span class="n">afterMin2Mono_normalization</span><span class="p">;</span>
    <span class="p">}</span>



    <span class="n">HDC</span> <span class="n">memDC</span> <span class="o">=</span> <span class="n">CreateCompatibleDC</span><span class="p">(</span><span class="n">hdc</span><span class="p">);</span>
    <span class="n">HBITMAP</span> <span class="n">memBM</span> <span class="o">=</span> <span class="n">CreateCompatibleBitmap</span><span class="p">(</span><span class="n">hdc</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">);</span>
    <span class="n">HBITMAP</span> <span class="n">holdBM</span> <span class="o">=</span> <span class="p">(</span><span class="n">HBITMAP</span><span class="p">)</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">memBM</span><span class="p">);</span>

    <span class="n">RECT</span> <span class="n">rect</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">20</span> <span class="p">};</span>
    <span class="n">HBRUSH</span> <span class="n">newbrush</span> <span class="o">=</span> <span class="n">CreateSolidBrush</span><span class="p">(</span><span class="n">RGB</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
    <span class="n">HBRUSH</span> <span class="n">oldbrush</span> <span class="o">=</span> <span class="p">(</span><span class="n">HBRUSH</span><span class="p">)</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">newbrush</span><span class="p">);</span>
    <span class="n">FillRect</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">rect</span><span class="p">,</span> <span class="n">newbrush</span><span class="p">);</span>
    <span class="n">SelectObject</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">oldbrush</span><span class="p">);</span>
    <span class="n">DeleteObject</span><span class="p">(</span><span class="n">newbrush</span><span class="p">);</span>

    <span class="n">HPEN</span> <span class="n">tPen</span> <span class="o">=</span> <span class="n">CreatePen</span><span class="p">(</span><span class="n">PS_SOLID</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">));</span>
    <span class="n">HPEN</span> <span class="n">oPen</span> <span class="o">=</span> <span class="p">(</span><span class="n">HPEN</span><span class="p">)</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">tPen</span><span class="p">);</span>
    <span class="n">MoveToEx</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
    <span class="n">LineTo</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">20</span><span class="p">);</span>
    <span class="n">ChangeFontSize</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">));</span>
    <span class="n">TCHAR</span>  <span class="n">tempTchr</span><span class="p">[</span><span class="mi">6</span><span class="p">];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="mi">50</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">MoveToEx</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">20</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">LineTo</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">20</span> <span class="o">+</span> <span class="mi">6</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">timeTemp</span> <span class="o">=</span> <span class="p">(</span><span class="mi">20</span> <span class="o">*</span> <span class="n">i</span><span class="o">*</span> <span class="n">audio</span><span class="p">.</span><span class="n">duration</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">timeTemp</span> <span class="o">/</span> <span class="mi">60</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">timeTemp</span> <span class="o">%</span> <span class="mi">60</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
                    <span class="n">wsprintf</span><span class="p">(</span><span class="n">tempTchr</span><span class="p">,</span> <span class="sa">L</span><span class="s">&quot;%d:%d&quot;</span><span class="p">,</span> <span class="n">timeTemp</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span> <span class="n">timeTemp</span> <span class="o">%</span> <span class="mi">60</span><span class="p">);</span>
                <span class="k">else</span>
                    <span class="nf">wsprintf</span><span class="p">(</span><span class="n">tempTchr</span><span class="p">,</span> <span class="sa">L</span><span class="s">&quot;%d:0%d&quot;</span><span class="p">,</span> <span class="n">timeTemp</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span> <span class="n">timeTemp</span> <span class="o">%</span> <span class="mi">60</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span>
            <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">timeTemp</span> <span class="o">%</span> <span class="mi">60</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span><span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
                    <span class="n">wsprintf</span><span class="p">(</span><span class="n">tempTchr</span><span class="p">,</span> <span class="sa">L</span><span class="s">&quot;0%d:%d&quot;</span><span class="p">,</span> <span class="n">timeTemp</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span> <span class="n">timeTemp</span> <span class="o">%</span> <span class="mi">60</span><span class="p">);</span>
                <span class="k">else</span>
                    <span class="nf">wsprintf</span><span class="p">(</span><span class="n">tempTchr</span><span class="p">,</span> <span class="sa">L</span><span class="s">&quot;0%d:0%d&quot;</span><span class="p">,</span> <span class="n">timeTemp</span> <span class="o">/</span> <span class="mi">60</span><span class="p">,</span> <span class="n">timeTemp</span> <span class="o">%</span> <span class="mi">60</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">ExtTextOut</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">15</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">20</span> <span class="o">+</span> <span class="mi">8</span><span class="p">,</span> <span class="n">ETO_OPAQUE</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="n">tempTchr</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span><span class="c1">//20080710</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">LineTo</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="mi">20</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="n">height</span> <span class="o">-</span> <span class="mi">20</span> <span class="o">+</span> <span class="mi">3</span><span class="p">);</span>
        <span class="p">}</span>

    <span class="p">}</span>


    <span class="n">tPen</span> <span class="o">=</span> <span class="n">CreatePen</span><span class="p">(</span><span class="n">PS_SOLID</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">RGB</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
    <span class="n">oPen</span> <span class="o">=</span> <span class="p">(</span><span class="n">HPEN</span><span class="p">)</span><span class="n">SelectObject</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">tPen</span><span class="p">);</span>

    <span class="p">{</span>
        <span class="kt">int</span> <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">height</span> <span class="o">-</span> <span class="mi">20</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">drawOffset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">heightRate</span> <span class="o">=</span> <span class="mf">1.0f</span> <span class="o">/</span> <span class="n">center</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">scCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">audio</span><span class="p">.</span><span class="n">channels</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">scCount</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span>
        <span class="p">{</span>
            <span class="n">scCount</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;drawByts_size=%d&quot;</span><span class="p">),</span> <span class="n">drawByts_size</span><span class="p">);</span>
        <span class="kt">double</span> <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">posy</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">sc</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">sc</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="n">drawByts_size</span><span class="p">;</span> <span class="n">sc</span><span class="o">++</span><span class="p">){</span><span class="c1">//resmiple</span>
            <span class="n">MoveToEx</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">sc</span> <span class="o">/</span> <span class="n">scCount</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>
            <span class="c1">//for (int i = 0; i &amp;lt; width - sc; i++)</span>
            <span class="p">{</span>

                <span class="c1">//Log(TEXT(&quot;data[%d]: %f&quot;), i, normalization[i]);</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">normalization</span><span class="p">[</span><span class="n">sc</span><span class="p">];</span>

                <span class="n">posy</span> <span class="o">=</span> <span class="kt">int</span><span class="p">((</span><span class="kt">double</span><span class="p">)</span><span class="n">center</span> <span class="o">-</span> <span class="n">val</span> <span class="o">/</span> <span class="n">heightRate</span><span class="p">);</span>
                <span class="n">LineTo</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">sc</span> <span class="o">/</span> <span class="n">scCount</span> <span class="o">+</span> <span class="n">drawOffset</span><span class="p">,</span> <span class="n">posy</span><span class="p">);</span>
                <span class="c1">//Log(TEXT(&quot;  [%d]:center = %d, normalization = %f, heightRate = %f,hi =%f, posy = %d &quot;), i, center, val, heightRate, hi, posy);</span>

            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>


    <span class="n">SelectObject</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">oPen</span><span class="p">);</span>
    <span class="n">DeleteObject</span><span class="p">(</span><span class="n">tPen</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">normalization</span><span class="p">)</span>
        <span class="n">free</span><span class="p">(</span><span class="n">normalization</span><span class="p">);</span>


    <span class="n">BITMAP</span> <span class="n">BmpInfo</span><span class="p">;</span>
    <span class="n">GetObject</span><span class="p">(</span><span class="n">memBM</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAP</span><span class="p">),</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">BmpInfo</span><span class="p">);</span><span class="c1">//get info</span>
    <span class="kt">int</span> <span class="n">datasize</span> <span class="o">=</span> <span class="n">BmpInfo</span><span class="p">.</span><span class="n">bmWidthBytes</span><span class="o">*</span><span class="n">BmpInfo</span><span class="p">.</span><span class="n">bmHeight</span><span class="p">;</span>
    <span class="kt">char</span><span class="o">*</span><span class="n">bmp_data</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="n">datasize</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">bmp_data</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">SelectObject</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">holdBM</span><span class="p">);</span>
        <span class="n">DeleteObject</span><span class="p">(</span><span class="n">memBM</span><span class="p">);</span>
        <span class="n">DeleteObject</span><span class="p">(</span><span class="n">memDC</span><span class="p">);</span>
        <span class="o">::</span><span class="n">ReleaseDC</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="n">hdc</span><span class="p">);</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;bmp_data malloc err&quot;</span><span class="p">));</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">BITMAPINFO</span> <span class="n">binfo</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
    <span class="n">BITMAPINFOHEADER</span> <span class="o">*</span><span class="n">bh</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">binfo</span><span class="p">.</span><span class="n">bmiHeader</span><span class="p">;</span>

    <span class="n">bh</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">biBitCount</span> <span class="o">=</span> <span class="n">BmpInfo</span><span class="p">.</span><span class="n">bmBitsPixel</span><span class="p">;</span><span class="c1">//Bits</span>
    <span class="n">bh</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">biClrImportant</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">bh</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">biCompression</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">bh</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">biHeight</span> <span class="o">=</span> <span class="n">height</span><span class="p">;</span>
    <span class="n">bh</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">biPlanes</span> <span class="o">=</span> <span class="n">BmpInfo</span><span class="p">.</span><span class="n">bmPlanes</span><span class="p">;</span><span class="c1">//1</span>
    <span class="n">bh</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">biSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">BITMAPINFO</span><span class="p">);</span>
    <span class="n">bh</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">biSizeImage</span> <span class="o">=</span> <span class="n">datasize</span><span class="p">;</span>
    <span class="n">bh</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">biWidth</span> <span class="o">=</span> <span class="n">width</span><span class="p">;</span>
    <span class="n">bh</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">biXPelsPerMeter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">bh</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">biYPelsPerMeter</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">GetDIBits</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">memBM</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">BmpInfo</span><span class="p">.</span><span class="n">bmHeight</span><span class="p">,</span> <span class="n">bmp_data</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">binfo</span><span class="p">,</span> <span class="n">DIB_RGB_COLORS</span><span class="p">);</span><span class="c1">//get RGB</span>


    <span class="c1">//HBITMAP hBmp = (HBITMAP)LoadImage(NULL, TEXT(&quot;.\\tmp.bmp&quot;), IMAGE_BITMAP, 0, 0, LR_CREATEDIBSECTION | LR_LOADFROMFILE);</span>

    <span class="c1">//IDM_VFR</span>
    <span class="o">::</span><span class="n">SendMessage</span><span class="p">(</span><span class="n">pWnd</span><span class="p">,</span> <span class="n">BM_SETIMAGE</span><span class="p">,</span> <span class="p">(</span><span class="n">WPARAM</span><span class="p">)</span><span class="n">IMAGE_BITMAP</span><span class="p">,</span> <span class="n">LPARAM</span><span class="p">(</span><span class="n">CreateDIBitmap</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">binfo</span><span class="p">.</span><span class="n">bmiHeader</span><span class="p">,</span> <span class="n">CBM_INIT</span><span class="p">,</span> <span class="p">(</span><span class="n">VOID</span><span class="o">*</span><span class="p">)</span><span class="n">bmp_data</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">binfo</span><span class="p">,</span> <span class="n">DIB_RGB_COLORS</span><span class="p">)));</span>


    <span class="n">free</span><span class="p">(</span><span class="n">bmp_data</span><span class="p">);</span>
    <span class="n">SelectObject</span><span class="p">(</span><span class="n">memDC</span><span class="p">,</span> <span class="n">holdBM</span><span class="p">);</span>
    <span class="n">DeleteObject</span><span class="p">(</span><span class="n">memBM</span><span class="p">);</span>
    <span class="n">DeleteObject</span><span class="p">(</span><span class="n">CreateDIBitmap</span><span class="p">);</span>
    <span class="n">DeleteObject</span><span class="p">(</span><span class="n">memDC</span><span class="p">);</span>
    <span class="n">DeleteDC</span><span class="p">(</span><span class="n">memDC</span><span class="p">);</span>

    <span class="o">::</span><span class="n">ReleaseDC</span><span class="p">(</span><span class="n">pWnd</span><span class="p">,</span> <span class="n">hdc</span><span class="p">);</span>

    <span class="n">HBITMAP</span> <span class="n">btm</span> <span class="o">=</span> <span class="n">LoadBitmap</span><span class="p">(</span><span class="n">hinstMain</span><span class="p">,</span> <span class="n">MAKEINTRESOURCE</span><span class="p">(</span><span class="n">IDB_BITMAP4</span><span class="p">));</span>
    <span class="o">::</span><span class="n">SendMessage</span><span class="p">(</span><span class="n">pWnd2</span><span class="p">,</span> <span class="n">BM_SETIMAGE</span><span class="p">,</span> <span class="p">(</span><span class="n">WPARAM</span><span class="p">)</span><span class="n">IMAGE_BITMAP</span><span class="p">,</span> <span class="p">(</span><span class="n">LPARAM</span><span class="p">)</span><span class="n">btm</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>



<span class="kt">void</span> <span class="n">Audio_tool_kk</span><span class="o">::</span><span class="n">D3D_init</span><span class="p">(</span><span class="n">HWND</span> <span class="n">hwnd</span><span class="p">,</span> <span class="kt">long</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//lpPtr1 = new LPVOID;</span>
    <span class="c1">//lpPtr2 = new LPVOID;</span>
    <span class="c1">//if (g_pD3DSound){ g_pD3DSound-&amp;gt;Release(); g_pD3DSound = NULL; }</span>
    <span class="n">DirectSoundCreate</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">g_pD3DSound</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>             <span class="c1">//创建播放设备  </span>
    <span class="n">g_pD3DSound</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">SetCooperativeLevel</span><span class="p">(</span><span class="n">hwnd</span><span class="p">,</span> <span class="n">DSSCL_NORMAL</span><span class="p">);</span>   <span class="c1">//设定协同等级，就是缓存的写入级别  </span>
    <span class="n">memset</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">dsbd</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">dsbd</span><span class="p">));</span>
    <span class="n">dsbd</span><span class="p">.</span><span class="n">dwSize</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">dsbd</span><span class="p">);</span>
    <span class="n">dsbd</span><span class="p">.</span><span class="n">dwFlags</span> <span class="o">=</span> <span class="n">DSBCAPS_GLOBALFOCUS</span><span class="p">;</span>                      <span class="c1">//这么设置保证在后台也能播放  </span>
    <span class="n">dsbd</span><span class="p">.</span><span class="n">dwBufferBytes</span> <span class="o">=</span> <span class="n">n</span><span class="p">;</span>                                  <span class="c1">//解码后的数据大小，以字节计算  </span>
    <span class="c1">//dsbd.lpwfxFormat = (WAVEFORMATEX*)malloc(sizeof(WAVEFORMATEX));</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Audio_tool_kk</span><span class="o">::</span><span class="n">D3D_cleanUp</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">D3D_play_callback</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;D3D_cleanUp&quot;</span><span class="p">));</span>
    <span class="n">EnterCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">cs</span><span class="p">);</span>
    <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;D3D_cleanUp111&quot;</span><span class="p">));</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g_pD3DSoundBuffer</span><span class="p">){</span> <span class="n">g_pD3DSoundBuffer</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">Release</span><span class="p">();</span> <span class="n">g_pD3DSoundBuffer</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">g_pD3DSound</span><span class="p">){</span> <span class="n">g_pD3DSound</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">Release</span><span class="p">();</span> <span class="n">g_pD3DSound</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span> <span class="p">}</span>
    <span class="n">LeaveCriticalSection</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">cs</span><span class="p">);</span>


<span class="p">}</span>

<span class="kt">void</span> <span class="n">Audio_tool_kk</span><span class="o">::</span><span class="n">D3D_open</span><span class="p">(</span><span class="n">audioData</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">audio</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//设置音频的格式  </span>
    <span class="n">waveform</span><span class="p">.</span><span class="n">wFormatTag</span> <span class="o">=</span> <span class="n">WAVE_FORMAT_PCM</span><span class="p">;</span>     <span class="c1">//PCM类型的声音  </span>
    <span class="n">waveform</span><span class="p">.</span><span class="n">nChannels</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">channels</span><span class="p">;</span>
    <span class="n">waveform</span><span class="p">.</span><span class="n">nSamplesPerSec</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">;</span>
    <span class="n">waveform</span><span class="p">.</span><span class="n">nAvgBytesPerSec</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">avg_bytes_sec</span><span class="p">;</span>
    <span class="n">waveform</span><span class="p">.</span><span class="n">nBlockAlign</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">block_align</span><span class="p">;</span>                  
    <span class="n">waveform</span><span class="p">.</span><span class="n">wBitsPerSample</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">bits_per_sample</span><span class="p">;</span>
    <span class="n">waveform</span><span class="p">.</span><span class="n">cbSize</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>                       <span class="c1">//额外信息，一般是0  </span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Audio_tool_kk</span><span class="o">::</span><span class="n">D3D_play</span><span class="p">(</span><span class="kt">long</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">DWORD</span> <span class="n">length1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="n">g_pD3DSoundBuffer</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">SetCurrentPosition</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>    <span class="c1">//设定播放位置从0开始  </span>
    <span class="n">g_pD3DSoundBuffer</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">Play</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span><span class="c1">// DSBPLAY_LOOPING);   //播放，循环  </span>
    <span class="c1">//等待播放完成  </span>
    <span class="n">g_pD3DSoundBuffer</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">GetStatus</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">state</span><span class="p">);</span>


    <span class="k">while</span> <span class="p">((</span><span class="n">state</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="n">state</span> <span class="o">==</span> <span class="mi">5</span><span class="p">))</span>                        <span class="c1">//1代表只放一次，5代表循环播放  </span>
    <span class="p">{</span>
        <span class="n">Sleep</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>                                   <span class="c1">//每隔200ms检测一次状态  </span>
        <span class="n">g_pD3DSoundBuffer</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">GetStatus</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">state</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">isStop</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">g_pD3DSoundBuffer</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">Stop</span><span class="p">();</span>
            <span class="n">Sleep</span><span class="p">(</span><span class="mi">200</span><span class="p">);</span>
            <span class="c1">//g_pD3DSoundBuffer-&amp;gt;GetStatus(&amp;amp;state);</span>
            <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;break&quot;</span><span class="p">));</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="c1">//Log(TEXT(&quot;playc: %lu   loadc:%lu ,state:%d&quot;), playc, loadc, state);</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Audio_tool_kk</span><span class="o">::</span><span class="n">stop</span><span class="p">()</span><span class="c1">//20150723-hll</span>
<span class="p">{</span>
    <span class="n">isStop</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">Audio_tool_kk</span><span class="o">::</span><span class="n">play</span><span class="p">(</span><span class="n">HWND</span> <span class="n">hwnd</span><span class="p">,</span> <span class="n">audioData</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">audio</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">isStop</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span><span class="c1">//20150723-hll</span>
    <span class="kt">long</span> <span class="n">n</span> <span class="o">=</span> <span class="n">audio</span><span class="p">.</span><span class="n">data_size</span> <span class="o">+</span> <span class="n">audio</span><span class="p">.</span><span class="n">sample_rate</span><span class="p">;</span>
    <span class="n">DWORD</span> <span class="n">length1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">length2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="c1">//D3D_cleanUp();</span>
    <span class="n">D3D_init</span><span class="p">(</span><span class="n">hwnd</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
    <span class="n">D3D_open</span><span class="p">(</span><span class="n">audio</span><span class="p">);</span>
    <span class="n">dsbd</span><span class="p">.</span><span class="n">lpwfxFormat</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">waveform</span><span class="p">;</span>
    <span class="c1">//if (g_pD3DSoundBuffer){</span>
    <span class="c1">//  g_pD3DSoundBuffer-&amp;gt;Release(); g_pD3DSoundBuffer = NULL;</span>
    <span class="c1">//}</span>
    <span class="n">g_pD3DSound</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">CreateSoundBuffer</span><span class="p">(</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">dsbd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">g_pD3DSoundBuffer</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">);</span>

    <span class="c1">//打开缓存以便写入，返回两个缓存可写入地址和他们的长度，一般来说第二个地址是没有的  </span>
    <span class="n">g_pD3DSoundBuffer</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">Lock</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">lpPtr1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">length1</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">lpPtr2</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">length2</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">memcpy</span><span class="p">(</span><span class="n">lpPtr1</span><span class="p">,</span> <span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">,</span> <span class="n">audio</span><span class="p">.</span><span class="n">data_size</span><span class="p">);</span>
    <span class="n">free</span><span class="p">(</span><span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">);</span>
    <span class="n">audio</span><span class="p">.</span><span class="n">data</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
    <span class="n">g_pD3DSoundBuffer</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">Unlock</span><span class="p">(</span><span class="n">lpPtr1</span><span class="p">,</span> <span class="n">length1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">g_pD3DSoundBuffer</span><span class="o">-&amp;</span><span class="n">gt</span><span class="p">;</span><span class="n">Unlock</span><span class="p">(</span><span class="n">lpPtr2</span><span class="p">,</span> <span class="n">length2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
    <span class="n">D3D_play</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>

    <span class="n">Audio_tool_kk</span><span class="o">::</span><span class="n">D3D_cleanUp</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">Audio_tool_kk</span><span class="o">::</span><span class="n">playCurAudio</span><span class="p">(</span><span class="n">HWND</span> <span class="n">hwnd</span><span class="p">,</span> <span class="n">PLAY_CALLBACK</span> <span class="n">cb</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">audio</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">Log</span><span class="p">(</span><span class="n">TEXT</span><span class="p">(</span><span class="s">&quot;error: load audio first&quot;</span><span class="p">));</span>
        <span class="k">return</span> <span class="n">FALSE</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">Audio_tool_kk</span><span class="o">::</span><span class="n">D3D_play_callback</span> <span class="o">=</span> <span class="n">cb</span><span class="p">;</span>
    <span class="n">Audio_tool_kk</span><span class="o">::</span><span class="n">play</span><span class="p">(</span><span class="n">hwnd</span><span class="p">,</span> <span class="n">audio</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">Audio_tool_kk</span><span class="o">::</span><span class="n">decodeAacToWave</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">pathName</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">ret</span><span class="o">=</span><span class="n">decodeAacToFile</span><span class="p">(</span><span class="n">pathName</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
        </div>
    </section>
    <footer class="footer-article">
        <div class="tags-and-categories">Filed under <a href="/category/yin-shi-pin.html">音视频</a>
        | Tagged: <a href="/tag/c.html">C++ </a><a href="/tag/audio.html">audio </a>
        | <a href="/2015/audio_2015_09_15_21_01.html" rel="bookmark"
         title="Permalink to 音频相关零碎">Permalink</a>            
        </div>
        <!-- metaldata 
        -->
    </footer>
</div>
<div id="disqus_thread"></div>
<script type="text/javascript" src="/theme/js/disqus.js"></script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
            </div>
            
            
			<div class="large-3 aside column">
				<img class="headIcon-large avatar" src="/sys_img/head.jpg" alt="(┬＿┬)">
                <h2>魏凯</h2>
                <h3>kairns leeky</h3>
				<a href="mailto:kai_kai03@hotmail.com?subject=%20&body=from%20blog"><Email>kai_kai03@hotmail.com</Email></a>
            </div>
            
            
			
			<div class="large-3 aside column">
                <h3>Socials</h3>
                <ul>
                    <li><a href="http://weibo.com/mipamipami">新浪weibo</a></li>
                    <li><a href="https://plus.google.com/105166364351021934050">g+</a></li>
                </ul>
            </div> 
            
            <div class="large-3 category-column column">
                <h3>Categories</h3>
                <ul>
                    <li><a href="/category/bu-kao-pu-chan-pin-ri-ji.html">不靠谱产品日记</a> (28)</li>
                    <li><a href="/category/db.html">DB</a> (3)</li>
                    <li><a href="/category/idev.html">iDev</a> (14)</li>
                    <li><a href="/category/machinelearning.html">MachineLearning</a> (24)</li>
                    <li><a href="/category/musical.html">Musical</a> (3)</li>
                    <li><a href="/category/other.html">other</a> (3)</li>
                    <li><a href="/category/pydev.html">pyDev</a> (19)</li>
                    <li class="active"><a href="/category/yin-shi-pin.html">音视频</a> (18)</li>
                </ul>
            </div> 
            
            <div class="large-3 category-column column">
                <h3>Feeds</h3>
                <ul>
                    <li ><a href="/feeds/all.atom.xml" type="application/atom+xml">Atom Feed</a></li>
                    <li ><a href="/feeds/all.rss.xml" type="application/rss+xml">RSS Feed</a></li>
                </ul>
            </div>
            
        
        

                <!--
            <iframe width="100%" height="600" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=600&fansRow=1&ptype=1&speed=0&skin=1&isTitle=0&noborder=0&isWeibo=1&isFans=0&uid=1819436507&verifier=4060feb2&colors=fc1f12,ffffff,666666,0082cb,ecfbfd&dpc=1"></iframe>            </div>
            -->
         
    </div>
</div>
    <div class="footer">
        <div class="data-holder">
        <div class="row">
            <div class="large-3 column">
<div class="Verse">
    <h3>bo主偈语</h3>
    <p>これも欲しい</p>
    <p>あれも欲しい</p>
    <p1>金がなくて悲しい</p1>
    <p>これもセール</p>
    <p>あれもセール</p>
    <p1>全部買うと責められる</p1>
    <p>これかっこい</p>
    <p>あれも可愛い</p>
    <p1>買えないので悔しい</p1>
    <p>いつ金が入る？</p>
    <p>いつ金が入る？</p>
    <p1>あの時まだ間に合う？</p1>
    <p>phaも買った</p>
    <p>hmzも買った</p>
    <p>嬉しいけど.....</p>
    <p1>土しか食べられるものは無かった</p1>
    <p1>嗯...2015年...vps不续费了...</p1>
</div>           </div>
           <div class="large-6 tag-cloud column">
                <h3>Tags</h3>
                <ul class="tagcloud">
                    <li>
											<span class="badge">3</span>
                        <a href="/tag/nao-dong.html">脑洞
                        </a></li>
                    <li>
											<span class="badge">3</span>
                        <a href="/tag/chord.html">Chord
                        </a></li>
                    <li>
											<span class="badge">2</span>
                        <a href="/tag/websocket.html">WebSocket
                        </a></li>
                    <li>
											<span class="badge">3</span>
                        <a href="/tag/mongo.html">mongo
                        </a></li>
                    <li>
											<span class="badge">3</span>
                        <a href="/tag/classification.html">classification
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/shi-xu-tu.html">时序图
                        </a></li>
                    <li>
											<span class="badge">33</span>
                        <a href="/tag/chan-pin.html">产品
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/fuck.html">fuck
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/gc.html">GC
                        </a></li>
                    <li>
											<span class="badge">2</span>
                        <a href="/tag/rtmp.html">RTMP
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/unicode.html">unicode
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/dylib.html">dylib
                        </a></li>
                    <li>
											<span class="badge">3</span>
                        <a href="/tag/protocol.html">protocol
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/pycon.html">PyCon
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/cai-ji.html">采集
                        </a></li>
                    <li>
											<span class="badge">3</span>
                        <a href="/tag/clustering.html">clustering
                        </a></li>
                    <li>
											<span class="badge">7</span>
                        <a href="/tag/web.html">Web
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/yi-zhi.html">移植
                        </a></li>
                    <li>
											<span class="badge">2</span>
                        <a href="/tag/network.html">network
                        </a></li>
                    <li>
											<span class="badge">6</span>
                        <a href="/tag/flask.html">Flask
                        </a></li>
                    <li>
											<span class="badge">2</span>
                        <a href="/tag/review.html">review
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/nodejs.html">Node.js
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/pep.html">PEP
                        </a></li>
                    <li>
											<span class="badge">2</span>
                        <a href="/tag/linear.html">Linear
                        </a></li>
                    <li>
											<span class="badge">4</span>
                        <a href="/tag/features.html">Features
                        </a></li>
                    <li>
											<span class="badge">4</span>
                        <a href="/tag/wu-tai.html">舞台
                        </a></li>
                    <li>
											<span class="badge">2</span>
                        <a href="/tag/cnn.html">CNN
                        </a></li>
                    <li>
											<span class="badge">4</span>
                        <a href="/tag/pca.html">PCA
                        </a></li>
                    <li>
											<span class="badge">7</span>
                        <a href="/tag/webrtc.html">webRtc
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/css.html">CSS
                        </a></li>
                    <li>
											<span class="badge">8</span>
                        <a href="/tag/object-c.html">Object-C
                        </a></li>
                    <li>
											<span class="badge">4</span>
                        <a href="/tag/memory.html">Memory
                        </a></li>
                    <li>
											<span class="badge">2</span>
                        <a href="/tag/life.html">life
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/flask-socketio.html">Flask-SocketIO
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/http.html">HTTP
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/finance.html">finance
                        </a></li>
                    <li>
											<span class="badge">4</span>
                        <a href="/tag/dataprocessing.html">DataProcessing
                        </a></li>
                    <li>
											<span class="badge">18</span>
                        <a href="/tag/python.html">Python
                        </a></li>
                    <li>
											<span class="badge">6</span>
                        <a href="/tag/javascript.html">JavaScript
                        </a></li>
                    <li>
											<span class="badge">18</span>
                        <a href="/tag/ios.html">iOS
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/encode.html">encode
                        </a></li>
                    <li>
											<span class="badge">2</span>
                        <a href="/tag/xcode.html">xCode
                        </a></li>
                    <li>
											<span class="badge">4</span>
                        <a href="/tag/appstore.html">appstore
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/html5.html">html5
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/liu-cheng.html">流程
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/uiimage.html">UIImage
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/decorator.html">Decorator
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/ipad.html">iPad
                        </a></li>
                    <li>
											<span class="badge">5</span>
                        <a href="/tag/c.html">C++
                        </a></li>
                    <li>
											<span class="badge">3</span>
                        <a href="/tag/jia-gou.html">架构
                        </a></li>
                    <li>
											<span class="badge">3</span>
                        <a href="/tag/ffmpeg.html">FFmpeg
                        </a></li>
                    <li>
											<span class="badge">22</span>
                        <a href="/tag/algorithm.html">algorithm
                        </a></li>
                    <li>
											<span class="badge">3</span>
                        <a href="/tag/database.html">database
                        </a></li>
                    <li>
											<span class="badge">17</span>
                        <a href="/tag/ml.html">ML
                        </a></li>
                    <li>
											<span class="badge">4</span>
                        <a href="/tag/yan-zou.html">演奏
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/framework.html">framework
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/gbk.html">GBK
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/rfc.html">rfc
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/cache.html">cache
                        </a></li>
                    <li>
											<span class="badge">19</span>
                        <a href="/tag/math.html">Math
                        </a></li>
                    <li>
											<span class="badge">3</span>
                        <a href="/tag/audio.html">audio
                        </a></li>
                    <li>
											<span class="badge">1</span>
                        <a href="/tag/obs.html">OBS
                        </a></li>
                </ul>
            </div>

            <div class="large-3 aside column">
                <h3>Links</h3>
                <ul>
                    <li><a href="http://mikanani.me/">蜜柑计划</a></li><br/>
                    <li><a href="http://josh.agarrado.net/music/anime/index.php">ジョシュの楽譜集</a></li><br/>
                    <li><a href="http://deeplearning.stanford.edu/">Deep Learning</a></li><br/>
                    <li><a href="http://getpelican.com/">Pelican</a></li><br/>
                    <li><a href="http://python.org/">Python</a></li><br/>
                    <li><a href="http://jinja.pocoo.org/">Jinja2</a></li><br/>
                </ul>
                
            </div>

        </row>
        </div>
        <div class="row">
            <div class="small-12 column">
                <p style="font-size: 0.7em; text-align:center;">
                ∠( ᐛ 」∠)＿不会有人拉到这么下边的呀就算拉下来也不会去看的呀这么小的字也看不清的口牙！ ©2015.
                <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1257347159'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s95.cnzz.com/z_stat.php%3Fid%3D1257347159%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));</script>
                <!--<script type="text/javascript" src="/theme/js/analytics.js"></script> -->
                </p>
            </div>
        </div>
    </div>

    
</body>
</html>