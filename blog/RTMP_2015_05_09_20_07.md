Title: RTMP
Date: 2015-05-09 20:07
Modified: 2015-05-09 20:07
Category: 音视频
Tags: RTMP,protocol
Slug: RTMP_2015_05_09_20_07
Authors: kai_kai03
Summary: 协议简述


### 开篇废话 ###
因为开始弄的在线舞台直播需要对协议改造改造，所以今天去找了点资料，在这里记录一下简单的，官方文档实在太长懒得看了。

### RTMP 头 ###
完整的RTMP包头有12字节，由下面5个部分组成:

	  用途 	   大小(Byte)  	     含义
	Head_Type     1 	         包头
	TIMER 	      3 	        时间戳
	AMFSize 	  3 	       数据大小
	AMFType 	  1            数据类型
	StreamID 	  4              流ID

其中AMFType可以指定传输的类型，比如是单纯的视频流，单纯的音频流，或者音视频流。在这里是音视频流，其数值为0X16。

AMF数据, AMF有AMF0和AMF3 两种版本，只是细微的数据类型定义有点差异。以音视频流为例，那么在这里AMF数据肯定包括视频流数据，音频流数据2部分。

<center>![]({filename}/article_img/RTMP_2015_05_09_20_07/1.jpg)</center>

其实AMF数据就是多个videoTag和audioTag组合起来的。videoTag和audioTag结构见上图，codecFlag其实就是标志位，标志这是一个新的videoTag或audioTag。

AVCPacketType:

<center>![]({filename}/article_img/RTMP_2015_05_09_20_07/2.jpg)</center>

AACPacketType:

<center>![]({filename}/article_img/RTMP_2015_05_09_20_07/3.jpg)</center>

这里的timestamp应该是相对时间戳，为了保证音视频的同步。

最后才是真正的数据。

### RTMP 握手 ###
<center>![]({filename}/article_img/RTMP_2015_05_09_20_07/4.jpg)</center>