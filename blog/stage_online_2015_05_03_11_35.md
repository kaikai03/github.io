Title: 在线合奏舞台
Date: 2015-05-03 11:35
Modified: 2015-05-03 11:35
Category: 音视频
Tags: 舞台,演奏,架构,产品,脑洞
Slug: stage_online_2015_05_03_11_35
Authors: kai_kai03
Summary: 产品架构、技术


## 咪啪在线舞台 ##
<center>![]({filename}/article_img/stage_online_2015_05_03_11_35/1.png)</center>

## 架构（初构想） ##
<center>![]({filename}/article_img/stage_online_2015_05_03_11_35/2.png)</center>

1. 表演侧1：采集端利用OBS进行二次开发，加入登录、同步演出单、合成同步时间戳、演出节奏控制、画面控制等功能。
2. 合成端：利用合成编码服务器接受表演实时流，利用码流中额外附加的同步时间戳去除网络延迟影响，将每一路视频与伴奏（或节拍）对齐，然后合成为一路视频，发送给分发服务器。
3. 业务平台：调度、资源分配、还有各种业务。不多废话了。
4. 分发服务器：主要是租CDN，大幅降低宽带成本和尽可能降低观众端延迟。
5. 表演侧2：资源管理，用户自行上传后期制作的视频。
6. 文件服务器：管理用户上传视频、live表演录像视频点播功能。
7. 观众侧：web、mobile、弹幕播放器等，这个也没什么好说的。

## 技术相关 ##
### rtmp ###
虽然手上资源成熟的是rtsp、rtp，但介于现在大家都用rtmp了，再一个是CDN厂家那边对rtmp支持比较现成，于是乎，我们也跟上潮流好了。但是要对某部分的rtmp协议进行改造来支持我们某些特殊想法和控制，不过这也不是什么难事，而且是在体系内部使用，并不影响对外接口。

### 流媒体服务 ###
流媒体服务：red5，wowiz，FMS，现成的，到时候选一个好了。

### 弹幕播放器 ###
这个现在貌似也比较现成。

### 编解码 ###
搞很多年了，没啥新意。

### 合成 ###
合成这块是技术难度大头，画面合成这是小事，重点是声音这块。

一来是采集那端，毕竟一部分用户经济能力有限，mic的质量不敢恭维，这么一来就需要修音和降噪。

二来是合成端，多路混音的音质下降与路数有关。写了个简单的混音算法来试试，两路的混音用中端听音设备上已经能听出明显的劣化。我最终的目标是5路，那就更不用说音质变成什么鬼样了。预计后续真正动手的时候需要先傅立叶拆开再主成份建模来让消弱部分属于人耳不关注的部分才行。

三、重编码计算压力，应对大延迟的缓存压力，live采集时的带宽压力........